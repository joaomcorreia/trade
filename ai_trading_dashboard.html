<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JCW Trade Hub</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: #ffffff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border-radius: 15px;
            border: 1px solid rgba(0, 212, 255, 0.3);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .header h1 {
            color: #00d4ff;
            font-size: 2.5em;
            font-weight: 300;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .currency-switcher {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(0, 212, 255, 0.1);
            padding: 8px 15px;
            border-radius: 20px;
            border: 1px solid rgba(0, 212, 255, 0.3);
        }

        .currency-switcher label {
            color: #b8c6db;
            font-size: 14px;
            font-weight: 500;
        }

        .currency-switcher select {
            background: transparent;
            border: none;
            color: #00d4ff;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            outline: none;
        }

        .currency-switcher select option {
            background: #1a1a2e;
            color: #ffffff;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #00ff88;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }

            100% {
                opacity: 1;
            }
        }

        .info-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .info-card {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(0, 212, 255, 0.3);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .info-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0, 212, 255, 0.2);
        }

        .info-card h3 {
            color: #00d4ff;
            font-size: 1.2em;
            margin-bottom: 15px;
            border-bottom: 1px solid rgba(0, 212, 255, 0.3);
            padding-bottom: 10px;
        }

        /* Section Header Styles - Full Width */
        .section-header {
            width: 100%;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 15px;
            padding: 30px 40px;
            margin: 40px 0 30px 0;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
        }

        .section-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -50%;
            width: 200%;
            height: 100%;
            background: linear-gradient(
                90deg, 
                transparent, 
                rgba(0, 212, 255, 0.1), 
                transparent
            );
            transform: skewX(-45deg);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { left: -50%; }
            100% { left: 150%; }
        }

        .section-header h2 {
            color: #00d4ff;
            font-size: 2.2em;
            font-weight: 700;
            margin: 0 0 10px 0;
            text-shadow: 0 2px 8px rgba(0, 212, 255, 0.3);
            position: relative;
            z-index: 1;
        }

        .section-header p {
            color: #b8c6db;
            font-size: 1.1em;
            margin: 0;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 8px 0;
        }

        .metric-label {
            color: #b8c6db;
        }

        .metric-value {
            color: #00d4ff;
            font-weight: 600;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 2fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-container {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(0, 212, 255, 0.3);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .chart-container h3 {
            color: #00d4ff;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .chart-wrapper {
            height: 300px;
            width: 100%;
            position: relative;
        }

        .chart-wrapper canvas {
            max-height: 300px !important;
            height: 300px !important;
        }

        .trading-panel {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(0, 212, 255, 0.3);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .trading-panel h3 {
            color: #00d4ff;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-group label {
            display: block;
            margin-bottom: 8px;
            color: #b8c6db;
        }

        .control-group select,
        .control-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 8px;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: #ffffff;
            font-size: 14px;
        }

        .control-group select:focus,
        .control-group input:focus {
            outline: none;
            border-color: #00d4ff;
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.3);
        }

        .btn {
            background: linear-gradient(135deg, #00d4ff, #0099cc);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            width: 100%;
            margin-bottom: 10px;
        }

        .btn:hover {
            background: linear-gradient(135deg, #0099cc, #007399);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 212, 255, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff4757, #cc3a4a);
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #cc3a4a, #992d3a);
        }

        /* Custom Charts Section */
        .custom-charts-section {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid rgba(0, 212, 255, 0.3);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .custom-charts-section h3 {
            color: #00d4ff;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .chart-controls {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .chart-selector label {
            color: #b8c6db;
            font-weight: 500;
        }

        .chart-selector select {
            padding: 8px 12px;
            background: #16213e;
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 8px;
            color: #00d4ff;
            font-size: 14px;
        }

        .chart-selector select:focus {
            outline: none;
            border-color: #00d4ff;
            box-shadow: 0 0 5px rgba(0, 212, 255, 0.3);
        }

        .charts-grid {
            display: grid;
            gap: 20px;
            grid-template-columns: repeat(2, 1fr);
        }

        .charts-grid.single {
            grid-template-columns: 1fr;
        }

        .charts-grid.triple {
            grid-template-columns: repeat(3, 1fr);
        }

        .charts-grid.quad {
            grid-template-columns: repeat(2, 1fr);
        }

        .chart-container {
            background: rgba(22, 33, 62, 0.6);
            border-radius: 10px;
            padding: 15px;
            border: 1px solid rgba(0, 212, 255, 0.2);
            height: 280px;
        }

        .chart-container canvas {
            height: 200px !important;
            max-height: 200px !important;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .chart-header h4 {
            color: #00d4ff;
            margin: 0;
            font-size: 1.1em;
        }

        .chart-header select {
            padding: 6px 10px;
            background: #1a1a2e;
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 6px;
            color: #00d4ff;
            font-size: 12px;
        }

        .chart-header select:focus {
            outline: none;
            border-color: #00d4ff;
            box-shadow: 0 0 3px rgba(0, 212, 255, 0.3);
        }

        .data-status {
            font-size: 0.8em;
            font-weight: normal;
            margin-left: 8px;
        }

        @media (max-width: 768px) {

            .charts-grid,
            .charts-grid.triple,
            .charts-grid.quad {
                grid-template-columns: 1fr;
            }
        }

        .positions-table {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(0, 212, 255, 0.3);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .positions-table h3 {
            color: #00d4ff;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(0, 212, 255, 0.2);
        }

        th {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: #00d4ff;
            font-weight: 600;
        }

        td {
            color: #b8c6db;
        }

        .profit-positive {
            color: #00ff88;
        }

        .profit-negative {
            color: #ff4757;
        }

        .price-change {
            font-size: 0.9em;
            font-weight: 600;
            margin-left: 8px;
        }

        .price-change.positive {
            color: #00ff88;
        }

        .price-change.negative {
            color: #ff4757;
        }

        .market-prices {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid rgba(0, 212, 255, 0.3);
        }

        .market-prices h4 {
            color: #00d4ff;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .live-price-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(184, 198, 219, 0.1);
        }

        .live-price-item:last-child {
            border-bottom: none;
        }

        .price-symbol {
            font-weight: 600;
            color: #ffffff;
        }

        .price-value {
            text-align: right;
        }

        .price-main {
            font-weight: 600;
            color: #00d4ff;
        }

        .signal-item {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .signal-item:hover {
            transform: translateX(5px);
            border-color: #00d4ff;
        }

        .signal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .signal-symbol {
            color: #00d4ff;
            font-weight: 600;
        }

        .signal-action {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .signal-buy {
            background: linear-gradient(135deg, #00ff88, #00cc6a);
            color: white;
        }

        .signal-sell {
            background: linear-gradient(135deg, #ff4757, #cc3a4a);
            color: white;
        }

        .signal-confidence {
            color: #b8c6db;
            font-size: 12px;
        }

        /* News Section Styles */
        .news-container {
            max-height: 200px;
            overflow-y: auto;
        }

        .news-item {
            padding: 12px 0;
            border-bottom: 1px solid rgba(184, 198, 219, 0.1);
            margin-bottom: 8px;
        }

        .news-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .news-item.loading {
            color: #b8c6db;
            font-style: italic;
        }

        .news-headline {
            font-weight: 600;
            font-size: 14px;
            line-height: 1.3;
            margin-bottom: 4px;
            color: #ffffff;
        }

        .news-source {
            font-size: 11px;
            color: #b8c6db;
            margin-bottom: 2px;
        }

        .news-time {
            font-size: 10px;
            color: #888;
        }

        .news-sentiment-positive .news-headline {
            color: #00ff88;
        }

        .news-sentiment-negative .news-headline {
            color: #ff4757;
        }

        .news-sentiment-neutral .news-headline {
            color: #00d4ff;
        }

        .news-container::-webkit-scrollbar {
            width: 4px;
        }

        .news-container::-webkit-scrollbar-track {
            background: rgba(0, 212, 255, 0.1);
            border-radius: 2px;
        }

        .news-container::-webkit-scrollbar-thumb {
            background: rgba(0, 212, 255, 0.3);
            border-radius: 2px;
        }

        .news-container::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 212, 255, 0.5);
        }

        /* Make news headlines clickable */
        .news-headline {
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .news-headline:hover {
            text-shadow: 0 0 5px currentColor;
            transform: translateX(3px);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            margin: 5% auto;
            padding: 30px;
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 15px;
            width: 80%;
            max-width: 700px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            position: relative;
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(0, 212, 255, 0.3);
        }

        .modal-title {
            color: #00d4ff;
            font-size: 1.4em;
            font-weight: 600;
            margin: 0;
            line-height: 1.3;
            flex: 1;
            margin-right: 20px;
        }

        .close {
            color: #b8c6db;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.2s ease;
            padding: 0;
            background: none;
            border: none;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close:hover,
        .close:focus {
            color: #ff4757;
            text-decoration: none;
        }

        .modal-meta {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            font-size: 14px;
            color: #b8c6db;
        }

        .modal-source {
            font-weight: 600;
            color: #00d4ff;
        }

        .modal-time {
            color: #888;
        }

        .modal-sentiment {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .modal-sentiment.positive {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
        }

        .modal-sentiment.negative {
            background: rgba(255, 71, 87, 0.2);
            color: #ff4757;
        }

        .modal-sentiment.neutral {
            background: rgba(0, 212, 255, 0.2);
            color: #00d4ff;
        }

        .modal-content-text {
            color: #ffffff;
            line-height: 1.6;
            font-size: 16px;
            margin-bottom: 20px;
        }

        .modal-footer {
            padding-top: 20px;
            border-top: 1px solid rgba(184, 198, 219, 0.1);
            text-align: center;
        }

        .modal-disclaimer {
            font-size: 12px;
            color: #888;
            font-style: italic;
        }

        @media (max-width: 768px) {
            .modal-content {
                width: 95%;
                margin: 10% auto;
                padding: 20px;
            }

            .modal-title {
                font-size: 1.2em;
            }
        }

        @media (max-width: 1024px) {
            .charts-grid {
                grid-template-columns: 1fr 1fr;
                gap: 15px;
            }

            .charts-grid .chart-container {
                grid-column: 1 / -1;
                /* Portfolio chart spans full width on tablets */
            }
        }

        @media (max-width: 768px) {
            .info-row {
                grid-template-columns: 1fr;
            }

            .charts-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Footer Styles */
        .dashboard-footer {
            height: 250px;
            background: linear-gradient(135deg, #16213e, #1a1a2e);
            border-top: 2px solid #00d4ff;
            margin-top: 40px;
            padding: 30px 20px 20px;
            color: #b8c6db;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3);
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 30px;
            flex: 1;
        }

        .footer-section h3 {
            color: #00d4ff;
            font-size: 1.1em;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .footer-section p {
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .footer-stats,
        .footer-performance {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .footer-stat,
        .perf-metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
            border-bottom: 1px solid rgba(0, 212, 255, 0.1);
        }

        .stat-label,
        .perf-label {
            font-size: 12px;
            color: #888;
        }

        .stat-value,
        .perf-value {
            font-size: 13px;
            color: #00d4ff;
            font-weight: 600;
        }

        .footer-markets {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .footer-market {
            font-size: 13px;
            padding: 5px 8px;
            background: rgba(0, 212, 255, 0.1);
            border-radius: 8px;
            text-align: center;
            border: 1px solid rgba(0, 212, 255, 0.2);
        }

        .footer-status {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4caf50;
            animation: pulse 2s infinite;
        }

        .status-dot.warning {
            background: #ff9800;
        }

        .status-dot.error {
            background: #f44336;
        }

        .footer-bottom {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 15px;
            border-top: 1px solid rgba(0, 212, 255, 0.2);
            margin-top: 15px;
        }

        .footer-copyright,
        .footer-version {
            font-size: 12px;
            color: #888;
        }

        @media (max-width: 1024px) {
            .footer-content {
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
            }
        }

        @media (max-width: 768px) {
            .dashboard-footer {
                height: auto;
                min-height: 250px;
                padding: 20px;
            }

            .footer-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .footer-bottom {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>JCW Trade Hub</h1>
            <h2>AI Trading Dashboard</h2>
            <div class="header-controls">
                <div class="currency-switcher">
                    <label for="currencySelect">üí±</label>
                    <select id="currencySelect" onchange="changeCurrency()">
                        <option value="USD">USD</option>
                        <option value="EUR">EUR</option>
                    </select>
                </div>
                <div class="status-indicator">
                    <div class="status-dot"></div>
                    <span>AI Active</span>
                </div>
            </div>
        </div>

        <div class="info-row">
            <div class="info-card">
                <h3>Trading Statistics</h3>
                <div class="metric">
                    <span class="metric-label">Total Portfolio Value:</span>
                    <span class="metric-value" id="portfolioValue">$0.00</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Today's P&L:</span>
                    <span class="metric-value" id="todayPnl">$0.00 (0.00%)</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Total Return:</span>
                    <span class="metric-value" id="totalReturn">$0.00 (0.0%)</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Win Rate:</span>
                    <span class="metric-value" id="winRate">0.0%</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Active Positions:</span>
                    <span class="metric-value" id="activePositions">0</span>
                </div>
            </div>

            <div class="info-card">
                <h3>AI Analysis</h3>
                <div class="metric">
                    <span class="metric-label">Market Sentiment:</span>
                    <span class="metric-value" id="marketSentiment">Bullish</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Confidence Level:</span>
                    <span class="metric-value" id="confidenceLevel">85%</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Risk Level:</span>
                    <span class="metric-value" id="riskLevel">Medium</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Next Action:</span>
                    <span class="metric-value" id="nextAction">Monitor TSLA</span>
                </div>
                <div class="metric">
                    <span class="metric-label">AI Status:</span>
                    <span class="metric-value profit-positive" id="aiStatus">Active</span>
                </div>
            </div>
            <div class="info-card">
                <h3>Live Signals</h3>
                <div id="liveSignals">
                    <div class="signal-item">
                        <div class="signal-header">
                            <span class="signal-symbol">AAPL</span>
                            <span class="signal-action signal-buy">BUY</span>
                        </div>
                        <div class="signal-confidence">Confidence: 92%</div>
                    </div>
                    <div class="signal-item">
                        <div class="signal-header">
                            <span class="signal-symbol">GOOGL</span>
                            <span class="signal-action signal-sell">SELL</span>
                        </div>
                        <div class="signal-confidence">Confidence: 87%</div>
                    </div>
                    <div class="signal-item">
                        <div class="signal-header">
                            <span class="signal-symbol">MSFT</span>
                            <span class="signal-action signal-buy">BUY</span>
                        </div>
                        <div class="signal-confidence">Confidence: 79%</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Market Instruments Section Header -->
        <div class="section-header">
            <h2>üìä Market Instruments</h2>
            <p>Real-time prices across global markets</p>
        </div>

        <div class="info-row">
            <!-- Stocks Market Data -->
            <div class="info-card">
                <h3>üìà Stocks</h3>
                <div class="metric">
                    <span class="metric-label">AAPL:</span>
                    <span class="metric-value" id="aaplPrice">Loading...</span>
                    <span class="price-change" id="aaplChange">--</span>
                </div>
                <div class="metric">
                    <span class="metric-label">MSFT:</span>
                    <span class="metric-value" id="msftPrice">Loading...</span>
                    <span class="price-change" id="msftChange">--</span>
                </div>
                <div class="metric">
                    <span class="metric-label">GOOGL:</span>
                    <span class="metric-value" id="googlPrice">Loading...</span>
                    <span class="price-change" id="googlChange">--</span>
                </div>
            </div>

            <!-- Crypto Market Data -->
            <div class="info-card">
                <h3>‚Çø Cryptocurrency</h3>
                <div class="metric">
                    <span class="metric-label">BTC-USD:</span>
                    <span class="metric-value" id="btcPrice">Loading...</span>
                    <span class="price-change" id="btcChange">--</span>
                </div>
                <div class="metric">
                    <span class="metric-label">ETH-USD:</span>
                    <span class="metric-value" id="ethPrice">Loading...</span>
                    <span class="price-change" id="ethChange">--</span>
                </div>
                <div class="metric">
                    <span class="metric-label">ADA-USD:</span>
                    <span class="metric-value" id="adaPrice">Loading...</span>
                    <span class="price-change" id="adaChange">--</span>
                </div>
            </div>

            <!-- Forex Market Data -->
            <div class="info-card">
                <h3>üí± Forex</h3>
                <div class="metric">
                    <span class="metric-label">EUR/USD:</span>
                    <span class="metric-value" id="eurusdPrice">Loading...</span>
                    <span class="price-change" id="eurusdChange">--</span>
                </div>
                <div class="metric">
                    <span class="metric-label">GBP/USD:</span>
                    <span class="metric-value" id="gbpusdPrice">Loading...</span>
                    <span class="price-change" id="gbpusdChange">--</span>
                </div>
                <div class="metric">
                    <span class="metric-label">USD/JPY:</span>
                    <span class="metric-value" id="usdjpyPrice">Loading...</span>
                    <span class="price-change" id="usdjpyChange">--</span>
                </div>
            </div>

            <!-- Commodities Market Data -->
            <div class="info-card">
                <h3>üõ¢Ô∏è Commodities</h3>
                <div class="metric">
                    <span class="metric-label">Gold:</span>
                    <span class="metric-value" id="goldPrice">Loading...</span>
                    <span class="price-change" id="goldChange">--</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Oil:</span>
                    <span class="metric-value" id="oilPrice">Loading...</span>
                    <span class="price-change" id="oilChange">--</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Silver:</span>
                    <span class="metric-value" id="silverPrice">Loading...</span>
                    <span class="price-change" id="silverChange">--</span>
                </div>
            </div>

            <!-- Indices Market Data -->
            <div class="info-card">
                <h3>üìä Indices</h3>
                <div class="metric">
                    <span class="metric-label">S&P 500:</span>
                    <span class="metric-value" id="spPrice">Loading...</span>
                    <span class="price-change" id="spChange">--</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Dow Jones:</span>
                    <span class="metric-value" id="dowPrice">Loading...</span>
                    <span class="price-change" id="dowChange">--</span>
                </div>
                <div class="metric">
                    <span class="metric-label">NASDAQ:</span>
                    <span class="metric-value" id="nasdaqPrice">Loading...</span>
                    <span class="price-change" id="nasdaqChange">--</span>
                </div>
            </div>

            <!-- Live Data Status -->
            <div class="info-card">
                <h3>üì° Live Data Status</h3>
                <div class="metric">
                    <span class="metric-label">Data Source:</span>
                    <span class="metric-value" id="dataSource">Yahoo Finance (Real-time)</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Last Update:</span>
                    <span class="metric-value" id="lastUpdate">Updating...</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Markets Active:</span>
                    <span class="metric-value profit-positive" id="marketsActive">5 Categories</span>
                </div>
            </div>
        </div>

        <!-- Market News Section Header -->
        <div class="section-header">
            <h2>üì∞ Market News</h2>
            <p>Latest market developments and analysis</p>
        </div>

        <div class="info-row">
            <!-- Positive Market News -->
            <div class="info-card">
                <h3>üì∞ Positive News</h3>
                <div id="positiveNews" class="news-container">
                    <div class="news-item loading">Loading positive market news...</div>
                </div>
            </div>

            <!-- Negative Market News -->
            <div class="info-card">
                <h3>üìâ Market Concerns</h3>
                <div id="negativeNews" class="news-container">
                    <div class="news-item loading">Loading market concerns...</div>
                </div>
            </div>

            <!-- General Market News -->
            <div class="info-card">
                <h3>üìä Market Updates</h3>
                <div id="generalNews" class="news-container">
                    <div class="news-item loading">Loading market updates...</div>
                </div>
            </div>

        </div>

        <div class="charts-grid">
            <!-- Current Positions - now first (left) -->
            <div class="positions-table" style="margin-top: 20px;">
                <h3>Current Positions</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Symbol</th>
                            <th>Quantity</th>
                            <th>Entry Price</th>
                            <th>Current Price</th>
                            <th>P&L</th>
                            <th>P&L %</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="positionsTable">
                        <tr id="noPositionsRow">
                            <td colspan="7" style="text-align: center; padding: 30px; color: #b8c6db; font-style: italic;">
                                No active positions. Start trading to see your positions here.
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="market-prices" id="marketPrices">
                <h4>Live Prices</h4>
                <div id="livePricesContainer">
                    Loading...
                </div>
            </div>
            <div class="trading-panel">
                <h3>Manual Trading</h3>
                <div class="control-group">
                    <label for="marketCategory">Market:</label>
                    <select id="marketCategory" onchange="loadMarketSymbols()">
                        <option value="stocks">Stocks</option>
                        <option value="crypto">Cryptocurrency</option>
                        <option value="forex">Forex</option>
                        <option value="commodities">Commodities</option>
                        <option value="indices">Indices</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="symbol">Symbol:</label>
                    <select id="symbol">
                        <option value="AAPL">Apple (AAPL)</option>
                        <option value="GOOGL">Google (GOOGL)</option>
                        <option value="MSFT">Microsoft (MSFT)</option>
                        <option value="TSLA">Tesla (TSLA)</option>
                        <option value="AMZN">Amazon (AMZN)</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="action">Action:</label>
                    <select id="action">
                        <option value="buy">Buy</option>
                        <option value="sell">Sell</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="quantity">Quantity:</label>
                    <input type="number" id="quantity" value="10" min="1">
                </div>
                <button class="btn" onclick="executeManualTrade()">Execute Trade</button>
                <button class="btn btn-danger" onclick="stopAllTrading()">Stop All Trading</button>


            </div>

            <!-- Portfolio Performance - now last (right with more space) -->
            <div class="chart-container">
                <h3>Portfolio Performance</h3>
                <div class="chart-wrapper">
                    <canvas id="portfolioChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Custom Chart Section -->
        <div class="custom-charts-section">
            <h3>üìä Custom Charts</h3>
            <div class="chart-controls">
                <div class="chart-selector">
                    <label for="chartCount">Number of Charts:</label>
                    <select id="chartCount" onchange="updateChartLayout()">
                        <option value="1">1 Chart</option>
                        <option value="2" selected>2 Charts</option>
                        <option value="3">3 Charts</option>
                        <option value="4">4 Charts</option>
                    </select>
                </div>
            </div>

            <div class="charts-grid" id="chartsGrid">
                <!-- Chart 1 -->
                <div class="chart-container" id="chartContainer1">
                    <div class="chart-header">
                        <h4>Chart 1 <span class="data-status" id="dataStatus1">üü° Loading...</span></h4>
                        <select id="chartSelect1" onchange="updateChart(1)">
                            <option value="btc">Bitcoin (BTC)</option>
                            <option value="eth">Ethereum (ETH)</option>
                            <option value="aapl">Apple (AAPL)</option>
                            <option value="tsla">Tesla (TSLA)</option>
                            <option value="spy">S&P 500 (SPY)</option>
                            <option value="eurusd">EUR/USD</option>
                            <option value="gold">Gold</option>
                            <option value="oil">Crude Oil</option>
                            <option value="portfolio">Portfolio Performance</option>
                        </select>
                    </div>
                    <canvas id="chart1" width="400" height="200"></canvas>
                </div>

                <!-- Chart 2 -->
                <div class="chart-container" id="chartContainer2">
                    <div class="chart-header">
                        <h4>Chart 2 <span class="data-status" id="dataStatus2">üü° Loading...</span></h4>
                        <select id="chartSelect2" onchange="updateChart(2)">
                            <option value="btc">Bitcoin (BTC)</option>
                            <option value="eth" selected>Ethereum (ETH)</option>
                            <option value="aapl">Apple (AAPL)</option>
                            <option value="tsla">Tesla (TSLA)</option>
                            <option value="spy">S&P 500 (SPY)</option>
                            <option value="eurusd">EUR/USD</option>
                            <option value="gold">Gold</option>
                            <option value="oil">Crude Oil</option>
                            <option value="portfolio">Portfolio Performance</option>
                        </select>
                    </div>
                    <canvas id="chart2" width="400" height="200"></canvas>
                </div>

                <!-- Chart 3 (Hidden initially) -->
                <div class="chart-container" id="chartContainer3" style="display: none;">
                    <div class="chart-header">
                        <h4>Chart 3 <span class="data-status" id="dataStatus3">üü° Loading...</span></h4>
                        <select id="chartSelect3" onchange="updateChart(3)">
                            <option value="btc">Bitcoin (BTC)</option>
                            <option value="eth">Ethereum (ETH)</option>
                            <option value="aapl" selected>Apple (AAPL)</option>
                            <option value="tsla">Tesla (TSLA)</option>
                            <option value="spy">S&P 500 (SPY)</option>
                            <option value="eurusd">EUR/USD</option>
                            <option value="gold">Gold</option>
                            <option value="oil">Crude Oil</option>
                            <option value="portfolio">Portfolio Performance</option>
                        </select>
                    </div>
                    <canvas id="chart3" width="400" height="200"></canvas>
                </div>

                <!-- Chart 4 (Hidden initially) -->
                <div class="chart-container" id="chartContainer4" style="display: none;">
                    <div class="chart-header">
                        <h4>Chart 4 <span class="data-status" id="dataStatus4">üü° Loading...</span></h4>
                        <select id="chartSelect4" onchange="updateChart(4)">
                            <option value="btc">Bitcoin (BTC)</option>
                            <option value="eth">Ethereum (ETH)</option>
                            <option value="aapl">Apple (AAPL)</option>
                            <option value="tsla" selected>Tesla (TSLA)</option>
                            <option value="spy">S&P 500 (SPY)</option>
                            <option value="eurusd">EUR/USD</option>
                            <option value="gold">Gold</option>
                            <option value="oil">Crude Oil</option>
                            <option value="portfolio">Portfolio Performance</option>
                        </select>
                    </div>
                    <canvas id="chart4" width="400" height="200"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- News Modal -->
    <div id="newsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle" class="modal-title"></h2>
                <button class="close" onclick="closeNewsModal()">&times;</button>
            </div>
            <div class="modal-meta">
                <span id="modalSource" class="modal-source"></span>
                <span id="modalTime" class="modal-time"></span>
                <span id="modalSentiment" class="modal-sentiment"></span>
            </div>
            <div id="modalContent" class="modal-content-text"></div>
            <div class="modal-footer">
                <p class="modal-disclaimer">This is simulated news content for demonstration purposes</p>
            </div>
        </div>
    </div>

    <script>
        // Portfolio Chart
        const ctx = document.getElementById('portfolioChart').getContext('2d');
        const portfolioChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                datasets: [{
                    label: 'Portfolio Value',
                    data: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    borderColor: '#00d4ff',
                    backgroundColor: 'rgba(0, 212, 255, 0.1)',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: {
                            color: '#ffffff'
                        }
                    }
                },
                scales: {
                    x: {
                        ticks: {
                            color: '#b8c6db'
                        },
                        grid: {
                            color: 'rgba(184, 198, 219, 0.1)'
                        }
                    },
                    y: {
                        ticks: {
                            color: '#b8c6db',
                            callback: function (value) {
                                return '$' + value.toLocaleString();
                            }
                        },
                        grid: {
                            color: 'rgba(184, 198, 219, 0.1)'
                        }
                    }
                }
            }
        });

        // Custom Charts Management
        let customCharts = {};
        let realTimeChartData = {};

        // Asset configuration mapping backend symbols to display
        const assetConfig = {
            btc: {
                label: 'Bitcoin (BTC)',
                symbol: 'BTC-USD',
                category: 'crypto',
                color: '#f7931a',
                precision: 0
            },
            eth: {
                label: 'Ethereum (ETH)',
                symbol: 'ETH-USD',
                category: 'crypto',
                color: '#627eea',
                precision: 0
            },
            aapl: {
                label: 'Apple (AAPL)',
                symbol: 'AAPL',
                category: 'stocks',
                color: '#1d1d1f',
                precision: 2
            },
            tsla: {
                label: 'Tesla (TSLA)',
                symbol: 'TSLA',
                category: 'stocks',
                color: '#cc0000',
                precision: 2
            },
            spy: {
                label: 'S&P 500 (SPY)',
                symbol: '^GSPC',
                category: 'indices',
                color: '#1f77b4',
                precision: 2
            },
            eurusd: {
                label: 'EUR/USD',
                symbol: 'EURUSD=X',
                category: 'forex',
                color: '#2ca02c',
                precision: 4
            },
            gold: {
                label: 'Gold',
                symbol: 'GC=F',
                category: 'commodities',
                color: '#ffd700',
                precision: 2
            },
            oil: {
                label: 'Crude Oil',
                symbol: 'CL=F',
                category: 'commodities',
                color: '#8c564b',
                precision: 2
            },
            portfolio: {
                label: 'Portfolio Performance',
                symbol: 'PORTFOLIO',
                category: 'portfolio',
                color: '#00d4ff',
                precision: 2
            }
        };

        // Fetch real market data for charts
        async function fetchRealChartData(assetKey) {
            const config = assetConfig[assetKey];
            if (!config) return null;

            try {
                if (config.category === 'portfolio') {
                    // Fresh start - no trading history yet
                    const currentValue = 0.00; // Starting with zero portfolio value
                    const months = 12;
                    const portfolioData = [];
                    
                    // Show flat zero line for fresh start
                    for (let i = 0; i < months; i++) {
                        portfolioData.push(0); // No trades yet, so zero value throughout
                    }
                    
                    return {
                        label: config.label,
                        data: portfolioData,
                        color: config.color,
                        precision: config.precision
                    };
                }

                // Fetch real market data from backend
                const response = await fetch(`http://localhost:8002/api/v1/market/prices/${config.category}?limit=10`);
                if (response.ok) {
                    const data = await response.json();
                    const assetData = data.prices[config.symbol];

                    if (assetData) {
                        const currentPrice = assetData.price;

                        // Generate realistic historical data based on current price
                        const historicalData = generateHistoricalData(currentPrice, config.precision);

                        return {
                            label: config.label,
                            data: historicalData,
                            color: config.color,
                            precision: config.precision,
                            currentPrice: currentPrice,
                            change: assetData.change || 0,
                            changePercent: assetData.changePercent || 0
                        };
                    }
                }

                // Fallback to demo data if API fails
                return getFallbackData(assetKey);

            } catch (error) {
                console.log(`Error fetching data for ${assetKey}:`, error);
                return getFallbackData(assetKey);
            }
        }

        // Generate realistic historical data based on current price
        function generateHistoricalData(currentPrice, precision = 2) {
            const dataPoints = [];
            let price = currentPrice;

            // Generate 12 months of data working backwards
            for (let i = 11; i >= 0; i--) {
                // Add some realistic volatility (¬±5% random walk)
                const volatility = (Math.random() - 0.5) * 0.1; // ¬±5%
                const monthlyChange = 1 + volatility;

                if (i === 0) {
                    // Last point should be current price
                    dataPoints.push(parseFloat(currentPrice.toFixed(precision)));
                } else {
                    // Work backwards with some trend
                    price = price / monthlyChange;
                    dataPoints.unshift(parseFloat(price.toFixed(precision)));
                }
            }

            return dataPoints;
        }

        // Fallback demo data if real data unavailable
        function getFallbackData(assetKey) {
            const fallbackData = {
                btc: { data: [95000, 98000, 92000, 101000, 105000, 99000, 103000, 108000, 104000, 110000, 107000, 106908], color: '#f7931a' },
                eth: { data: [3200, 3400, 3100, 3600, 3650, 3500, 3700, 3900, 3750, 4000, 3850, 3873], color: '#627eea' },
                aapl: { data: [150, 155, 148, 160, 165, 162, 168, 172, 170, 175, 180, 185], color: '#1d1d1f' },
                tsla: { data: [700, 750, 680, 800, 850, 820, 880, 920, 900, 950, 980, 1000], color: '#cc0000' },
                spy: { data: [4200, 4250, 4150, 4300, 4350, 4320, 4380, 4450, 4420, 4500, 4550, 4600], color: '#1f77b4' },
                eurusd: { data: [1.18, 1.19, 1.17, 1.20, 1.21, 1.19, 1.22, 1.18, 1.16, 1.15, 1.17, 1.18], color: '#2ca02c' },
                gold: { data: [1800, 1820, 1790, 1840, 1860, 1830, 1880, 1900, 1885, 1920, 1950, 1970], color: '#ffd700' },
                oil: { data: [70, 72, 68, 75, 78, 74, 80, 82, 79, 85, 88, 90], color: '#8c564b' }
            };

            const config = assetConfig[assetKey];
            const fallback = fallbackData[assetKey] || fallbackData.btc;

            return {
                label: config?.label || assetKey.toUpperCase(),
                data: fallback.data,
                color: fallback.color,
                precision: config?.precision || 2
            };
        }

        function updateChartLayout() {
            const chartCount = parseInt(document.getElementById('chartCount').value);
            const chartsGrid = document.getElementById('chartsGrid');

            // Hide all charts first
            for (let i = 1; i <= 4; i++) {
                const container = document.getElementById(`chartContainer${i}`);
                container.style.display = 'none';
            }

            // Show required number of charts
            for (let i = 1; i <= chartCount; i++) {
                const container = document.getElementById(`chartContainer${i}`);
                container.style.display = 'block';
            }

            // Update grid layout
            chartsGrid.className = 'charts-grid';
            if (chartCount === 1) {
                chartsGrid.classList.add('single');
            } else if (chartCount === 3) {
                chartsGrid.classList.add('triple');
            } else if (chartCount === 4) {
                chartsGrid.classList.add('quad');
            }

            // Initialize or update visible charts
            for (let i = 1; i <= chartCount; i++) {
                updateChart(i);
            }
        }

        async function updateChart(chartNumber) {
            const selectElement = document.getElementById(`chartSelect${chartNumber}`);
            const selectedAsset = selectElement.value;
            const statusElement = document.getElementById(`dataStatus${chartNumber}`);

            // Update status to loading
            if (statusElement) {
                statusElement.textContent = 'üü° Loading...';
            }

            // Fetch real-time data
            const data = await fetchRealChartData(selectedAsset);

            if (!data) return;

            // Update status based on data type
            if (statusElement) {
                if (data.currentPrice) {
                    statusElement.textContent = 'üü¢ Live Data';
                } else {
                    statusElement.textContent = 'üî¥ Demo Data';
                }
            }

            // Store the data for potential future use
            realTimeChartData[selectedAsset] = data;

            // Destroy existing chart if it exists
            if (customCharts[chartNumber]) {
                customCharts[chartNumber].destroy();
            }

            const ctx = document.getElementById(`chart${chartNumber}`).getContext('2d');
            customCharts[chartNumber] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                    datasets: [{
                        label: data.label,
                        data: data.data,
                        borderColor: data.color,
                        backgroundColor: data.color + '20',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: data.color,
                        pointBorderColor: data.color,
                        pointRadius: 3,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: 'rgba(26, 26, 46, 0.9)',
                            titleColor: '#00d4ff',
                            bodyColor: '#b8c6db',
                            borderColor: data.color,
                            borderWidth: 1
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            ticks: {
                                color: '#b8c6db',
                                font: {
                                    size: 10
                                }
                            },
                            grid: {
                                color: 'rgba(184, 198, 219, 0.1)',
                                display: false
                            }
                        },
                        y: {
                            display: true,
                            ticks: {
                                color: '#b8c6db',
                                font: {
                                    size: 10
                                },
                                callback: function (value) {
                                    const config = assetConfig[selectedAsset];
                                    const precision = config?.precision || 2;

                                    if (selectedAsset === 'portfolio') {
                                        return '$' + (value / 1000).toFixed(0) + 'K';
                                    } else if (selectedAsset === 'eurusd') {
                                        return value.toFixed(4);
                                    } else if (selectedAsset === 'btc') {
                                        if (value >= 1000) {
                                            return '$' + (value / 1000).toFixed(0) + 'K';
                                        } else {
                                            return '$' + value.toFixed(0);
                                        }
                                    } else if (selectedAsset === 'eth') {
                                        return '$' + value.toFixed(0);
                                    } else if (selectedAsset === 'gold' || selectedAsset === 'oil') {
                                        return '$' + value.toFixed(precision);
                                    } else {
                                        return '$' + value.toFixed(precision);
                                    }
                                }
                            },
                            grid: {
                                color: 'rgba(184, 198, 219, 0.1)'
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
        }

        // Refresh all visible charts with new data
        async function refreshAllCharts() {
            const chartCount = parseInt(document.getElementById('chartCount').value);

            for (let i = 1; i <= chartCount; i++) {
                const container = document.getElementById(`chartContainer${i}`);
                if (container.style.display !== 'none') {
                    await updateChart(i);
                }
            }
        }

        // Initialize charts on page load
        document.addEventListener('DOMContentLoaded', function () {
            updateChartLayout();

            // Refresh charts with real data every 5 minutes (less frequent to be gentle on connection)
            setInterval(refreshAllCharts, 300000); // 5 minutes
        });

        // Functions
        async function loadMarketSymbols() {
            const category = document.getElementById('marketCategory').value;
            try {
                const response = await fetch(`http://localhost:8002/api/v1/market/symbols/${category}`);
                if (response.ok) {
                    const data = await response.json();
                    const symbolSelect = document.getElementById('symbol');
                    symbolSelect.innerHTML = '';

                    for (const [symbol, name] of Object.entries(data.symbols)) {
                        const option = document.createElement('option');
                        option.value = symbol;
                        option.textContent = `${name} (${symbol})`;
                        symbolSelect.appendChild(option);
                    }

                    // Update live prices for this category
                    await updateCategoryPrices(category);
                }
            } catch (error) {
                console.log('Error loading market symbols:', error);
            }
        }

        async function updateCategoryPrices(category = null) {
            if (!category) {
                category = document.getElementById('marketCategory').value;
            }

            try {
                const response = await fetch(`http://localhost:8002/api/v1/market/prices/${category}?limit=5`);
                if (response.ok) {
                    const data = await response.json();
                    const container = document.getElementById('livePricesContainer');
                    container.innerHTML = '';

                    for (const [symbol, priceData] of Object.entries(data.prices)) {
                        const priceItem = document.createElement('div');
                        priceItem.className = 'live-price-item';

                        const changeClass = priceData.change_percent >= 0 ? 'positive' : 'negative';
                        // All prices should respect currency conversion
                        const displayPrice = formatPrice(priceData.price);
                            
                        priceItem.innerHTML = `
                            <div class="price-symbol">${symbol}</div>
                            <div class="price-value">
                                <div class="price-main">${displayPrice}</div>
                                <div class="price-change ${changeClass}">${priceData.change_percent.toFixed(2)}%</div>
                            </div>
                        `;
                        container.appendChild(priceItem);
                    }
                }
            } catch (error) {
                console.log('Error updating category prices:', error);
            }
        }

        function executeManualTrade() {
            const symbol = document.getElementById('symbol').value;
            const action = document.getElementById('action').value;
            const quantity = document.getElementById('quantity').value;
            const category = document.getElementById('marketCategory').value;

            alert(`Executing ${action.toUpperCase()} order for ${quantity} units of ${symbol} in ${category} market`);

            // Here you would make an API call to execute the trade
            fetch(`http://localhost:8002/api/v1/trading/execute?symbol=${symbol}&action=${action}&quantity=${quantity}&category=${category}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    symbol: symbol,
                    action: action,
                    quantity: quantity,
                    category: category
                })
            }).then(response => response.json())
                .then(data => {
                    alert(`Trade executed: ${data.action} ${data.quantity} ${data.symbol} at $${data.execution_price}`);
                })
                .catch(err => {
                    console.log('Trade execution error:', err);
                    alert('Trade execution failed. Please check if the backend is running.');
                });
        }

        // Update footer status and information
        async function updateFooter() {
            try {
                // Update backend status
                const backendStatus = document.getElementById('backend-status');
                const backendStatusText = document.getElementById('backend-status-text');

                try {
                    const response = await fetch('http://localhost:8002/api/v1/trading/status');
                    if (response.ok) {
                        backendStatus.className = 'status-dot';
                        backendStatusText.textContent = 'Online';
                    } else {
                        backendStatus.className = 'status-dot warning';
                        backendStatusText.textContent = 'Warning';
                    }
                } catch {
                    backendStatus.className = 'status-dot error';
                    backendStatusText.textContent = 'Offline';
                }

                // Update data feed status
                const dataStatus = document.getElementById('data-status');
                const dataStatusText = document.getElementById('data-status-text');

                try {
                    const priceResponse = await fetch('http://localhost:8002/api/v1/market/prices/stocks?limit=1');
                    if (priceResponse.ok) {
                        dataStatus.className = 'status-dot';
                        dataStatusText.textContent = 'Live';
                    } else {
                        dataStatus.className = 'status-dot warning';
                        dataStatusText.textContent = 'Delayed';
                    }
                } catch {
                    dataStatus.className = 'status-dot error';
                    dataStatusText.textContent = 'No Data';
                }

                // Update AI engine status
                const aiStatus = document.getElementById('ai-status');
                const aiStatusText = document.getElementById('ai-status-text');

                try {
                    const aiResponse = await fetch('http://localhost:8002/api/v1/trading/ai-signals');
                    if (aiResponse.ok) {
                        aiStatus.className = 'status-dot';
                        aiStatusText.textContent = 'Active';
                    } else {
                        aiStatus.className = 'status-dot warning';
                        aiStatusText.textContent = 'Limited';
                    }
                } catch {
                    aiStatus.className = 'status-dot error';
                    aiStatusText.textContent = 'Inactive';
                }

                // Update last update time
                const lastUpdate = document.getElementById('footer-last-update');
                if (lastUpdate) {
                    const now = new Date();
                    lastUpdate.textContent = now.toLocaleTimeString('en-US', {
                        hour12: false,
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                }

                // Update total trades and success rate
                try {
                    const statusResponse = await fetch('http://localhost:8002/api/v1/trading/status');
                    if (statusResponse.ok) {
                        const statusData = await statusResponse.json();

                        const totalTrades = document.getElementById('footer-total-trades');
                        const successRate = document.getElementById('footer-success-rate');

                        if (totalTrades) {
                            totalTrades.textContent = statusData.total_trades || '0';
                        }

                        if (successRate) {
                            const rate = statusData.success_rate || 0;
                            successRate.textContent = (rate * 100).toFixed(1) + '%';
                        }
                    }
                } catch (error) {
                    console.log('Error updating footer stats:', error);
                }

            } catch (error) {
                console.log('Error updating footer:', error);
            }
        }

        function stopAllTrading() {
            if (confirm('Are you sure you want to stop all trading activities?')) {
                alert('All trading stopped. AI system paused.');
                // API call to stop trading
            }
        }

        // Update data periodically
        async function updateDashboard() {
            try {
                // FRESH START: Override backend demo data with zero values for new account
                // Update portfolio value with fresh start (ignore backend $2,522.90 demo value)
                const portfolioElement = document.getElementById('portfolioValue');
                if (portfolioElement) {
                    portfolioElement.textContent = formatPrice(0.00); // Fresh start - ignore backend demo data
                }

                // Update P&L with fresh start (ignore backend demo values)
                const pnlElement = document.getElementById('todayPnl');
                if (pnlElement) {
                    pnlElement.textContent = `${formatPrice(0.00)} (0.00%)`;
                }

                // Update confidence level with real AI confidence from backend
                try {
                    const statusResponse = await fetch('http://localhost:8002/api/v1/trading/status');
                    if (statusResponse.ok) {
                        const statusData = await statusResponse.json();
                        const confidenceElement = document.getElementById('confidenceLevel');
                        if (confidenceElement) {
                            confidenceElement.textContent = (statusData.ai_confidence * 100).toFixed(0) + '%';
                        }

                        // Update status indicator
                        const statusElement = document.getElementById('tradingStatus');
                        if (statusElement) {
                            statusElement.textContent = statusData.is_active ? 'Active' : 'Inactive';
                        }
                    }
                } catch (error) {
                    console.log('Error fetching AI confidence:', error);
                }

                // Update active positions count - fresh start (ignore backend demo count)
                const positionsElement = document.getElementById('activePositions');
                if (positionsElement) {
                    positionsElement.textContent = '0'; // Fresh start - ignore backend demo positions
                }

                // Calculate and update win rate - fresh start
                const winRateElement = document.getElementById('winRate');
                if (winRateElement) {
                    winRateElement.textContent = '0.0%'; // No trades yet
                }

                // Fetch real market prices
                await updateAllMarketPrices();

                // Fetch real AI signals
                await updateAISignals();

                // Update current positions
                await updateCurrentPositions();

            } catch (error) {
                console.log('Dashboard update error (using fresh start data):', error);
                // Gracefully fallback to fresh start data
                updateWithFreshStartData();
                return false;
            }
        }

        async function updateAllMarketPrices() {
            try {
                // Update Stocks
                const stocksResponse = await fetch('http://localhost:8002/api/v1/market/prices/stocks?limit=3');
                if (stocksResponse.ok) {
                    const stocksData = await stocksResponse.json();
                    updatePriceData(stocksData.prices, {
                        'AAPL': { priceId: 'aaplPrice', changeId: 'aaplChange' },
                        'MSFT': { priceId: 'msftPrice', changeId: 'msftChange' },
                        'GOOGL': { priceId: 'googlPrice', changeId: 'googlChange' }
                    });
                }

                // Update Crypto
                const cryptoResponse = await fetch('http://localhost:8002/api/v1/market/prices/crypto?limit=3');
                if (cryptoResponse.ok) {
                    const cryptoData = await cryptoResponse.json();
                    updatePriceData(cryptoData.prices, {
                        'BTC-USD': { priceId: 'btcPrice', changeId: 'btcChange' },
                        'ETH-USD': { priceId: 'ethPrice', changeId: 'ethChange' },
                        'ADA-USD': { priceId: 'adaPrice', changeId: 'adaChange' }
                    });
                }

                // Update Forex
                const forexResponse = await fetch('http://localhost:8002/api/v1/market/prices/forex?limit=3');
                if (forexResponse.ok) {
                    const forexData = await forexResponse.json();
                    updatePriceData(forexData.prices, {
                        'EURUSD=X': { priceId: 'eurusdPrice', changeId: 'eurusdChange' },
                        'GBPUSD=X': { priceId: 'gbpusdPrice', changeId: 'gbpusdChange' },
                        'USDJPY=X': { priceId: 'usdjpyPrice', changeId: 'usdjpyChange' }
                    });
                }

                // Update Commodities
                const commoditiesResponse = await fetch('http://localhost:8002/api/v1/market/prices/commodities?limit=3');
                if (commoditiesResponse.ok) {
                    const commoditiesData = await commoditiesResponse.json();
                    updatePriceData(commoditiesData.prices, {
                        'GC=F': { priceId: 'goldPrice', changeId: 'goldChange' },
                        'CL=F': { priceId: 'oilPrice', changeId: 'oilChange' },
                        'SI=F': { priceId: 'silverPrice', changeId: 'silverChange' }
                    });
                }

                // Update Indices
                const indicesResponse = await fetch('http://localhost:8002/api/v1/market/prices/indices?limit=3');
                if (indicesResponse.ok) {
                    const indicesData = await indicesResponse.json();
                    updatePriceData(indicesData.prices, {
                        '^GSPC': { priceId: 'spPrice', changeId: 'spChange' },
                        '^DJI': { priceId: 'dowPrice', changeId: 'dowChange' },
                        '^IXIC': { priceId: 'nasdaqPrice', changeId: 'nasdaqChange' }
                    });
                }

                // Update last update time
                const lastUpdateElement = document.getElementById('lastUpdate');
                if (lastUpdateElement) {
                    lastUpdateElement.textContent = new Date().toLocaleTimeString();
                }

            } catch (error) {
                console.log('Market prices update failed (continuing with existing data):', error);
                // Don't disrupt user experience, just log the error
            }
        }

        async function updateWinRate() {
            try {
                const historyResponse = await fetch('http://localhost:8002/api/v1/trading/history');
                if (historyResponse.ok) {
                    const historyData = await historyResponse.json();
                    const trades = historyData.trades || [];
                    
                    if (trades.length > 0) {
                        // For now, calculate based on current positions profitability
                        const positionsResponse = await fetch('http://localhost:8002/api/v1/trading/positions');
                        if (positionsResponse.ok) {
                            const positionsData = await positionsResponse.json();
                            const positions = positionsData.positions || [];
                            
                            const profitablePositions = positions.filter(pos => pos.pnl > 0).length;
                            const totalPositions = positions.length;
                            
                            let winRate = totalPositions > 0 ? (profitablePositions / totalPositions * 100).toFixed(1) : 0;
                            
                            // If no trades yet, show a realistic starting rate
                            if (totalPositions === 0) {
                                winRate = '0.0';
                            }
                            
                            const winRateElement = document.getElementById('winRate');
                            if (winRateElement) {
                                winRateElement.textContent = `${winRate}%`;
                            }
                        }
                    } else {
                        // No trading history yet
                        const winRateElement = document.getElementById('winRate');
                        if (winRateElement) {
                            winRateElement.textContent = '0.0%';
                        }
                    }
                }
            } catch (error) {
                console.log('Win rate update failed, keeping existing value');
                // Keep the existing win rate display
            }
        }

        function updatePriceData(pricesData, elementMap) {
            for (const [symbol, elements] of Object.entries(elementMap)) {
                if (pricesData[symbol]) {
                    const priceData = pricesData[symbol];

                    // Update price
                    const priceElement = document.getElementById(elements.priceId);
                    if (priceElement) {
                        // Forex pairs should show their natural rates but respect currency setting
                        if (symbol.includes('USD') && symbol.includes('=X')) {
                            // For USD pairs, still use formatPrice to respect EUR conversion
                            priceElement.textContent = formatPrice(priceData.price);
                        } else {
                            priceElement.textContent = formatPrice(priceData.price);
                        }
                    }

                    // Update change
                    const changeElement = document.getElementById(elements.changeId);
                    if (changeElement) {
                        const changePercent = priceData.change_percent.toFixed(2);
                        const changeSign = priceData.change_percent >= 0 ? '+' : '';
                        changeElement.textContent = `${changeSign}${changePercent}%`;
                        changeElement.className = priceData.change_percent >= 0 ? 'price-change positive' : 'price-change negative';
                    }
                }
            }
        }

        async function updateAISignals() {
            try {
                const response = await fetch('http://localhost:8002/api/v1/trading/ai-signals');
                if (response.ok) {
                    const data = await response.json();

                    // Update AI signals display
                    const signalsContainer = document.getElementById('liveSignals');
                    if (signalsContainer && data.signals && data.signals.length > 0) {
                        signalsContainer.innerHTML = '';

                        data.signals.slice(0, 3).forEach(signal => {
                            const signalElement = document.createElement('div');
                            signalElement.className = 'signal-item';
                            signalElement.innerHTML = `
                                <div class="signal-header">
                                    <span class="signal-symbol">${signal.symbol}</span>
                                    <span class="signal-action signal-${signal.action.toLowerCase()}">${signal.action.toUpperCase()}</span>
                                </div>
                                <div class="signal-confidence">Confidence: ${(signal.confidence * 100).toFixed(0)}%</div>
                                <div class="signal-reasoning">${signal.reasoning}</div>
                            `;
                            signalsContainer.appendChild(signalElement);
                        });
                    }
                }
            } catch (error) {
                console.log('AI signals update error:', error);
            }
        }

        async function updateCurrentPositions() {
            try {
                const response = await fetch('http://localhost:8002/api/v1/trading/positions');
                if (response.ok) {
                    const data = await response.json();
                    let positions = data.positions || [];
                    
                    // TEMPORARY: Filter out demo/test positions for fresh start
                    // Remove any positions that look like demo data (AAPL with small quantities, etc.)
                    positions = positions.filter(pos => {
                        // Skip positions that appear to be demo data
                        if (pos.symbol === 'AAPL' && pos.quantity <= 100 && pos.pnl === 0) return false;
                        if (pos.symbol === 'GOOGL' && pos.quantity <= 100) return false;
                        if (pos.symbol === 'MSFT' && pos.quantity <= 100) return false;
                        return true;
                    });
                    
                    const positionsTable = document.getElementById('positionsTable');
                    if (!positionsTable) return;
                    
                    // Clear current table content
                    positionsTable.innerHTML = '';
                    
                    if (positions.length === 0) {
                        // Show empty state
                        const emptyRow = document.createElement('tr');
                        emptyRow.id = 'noPositionsRow';
                        emptyRow.innerHTML = `
                            <td colspan="7" style="text-align: center; padding: 30px; color: #b8c6db; font-style: italic;">
                                No active positions. Start trading to see your positions here.
                            </td>
                        `;
                        positionsTable.appendChild(emptyRow);
                    } else {
                        // Display actual positions
                        positions.forEach(position => {
                            const row = document.createElement('tr');
                            const pnlClass = position.pnl >= 0 ? 'profit-positive' : 'profit-negative';
                            const pnlSign = position.pnl >= 0 ? '+' : '';
                            const pnlPercent = position.pnl_percent || 0;
                            const pnlPercentSign = pnlPercent >= 0 ? '+' : '';
                            
                            row.innerHTML = `
                                <td>${position.symbol}</td>
                                <td>${position.quantity}</td>
                                <td>${formatPrice(position.entry_price)}</td>
                                <td>${formatPrice(position.current_price)}</td>
                                <td class="${pnlClass}">${pnlSign}${formatPrice(Math.abs(position.pnl))}</td>
                                <td class="${pnlClass}">${pnlPercentSign}${pnlPercent.toFixed(2)}%</td>
                                <td><button class="btn" style="width: auto; margin: 0;" onclick="closePosition('${position.symbol}')">Close</button></td>
                            `;
                            positionsTable.appendChild(row);
                        });
                    }
                }
            } catch (error) {
                console.log('Positions update error (showing empty state):', error);
                // Show empty state on error
                const positionsTable = document.getElementById('positionsTable');
                if (positionsTable) {
                    positionsTable.innerHTML = `
                        <tr id="noPositionsRow">
                            <td colspan="7" style="text-align: center; padding: 30px; color: #b8c6db; font-style: italic;">
                                No active positions. Start trading to see your positions here.
                            </td>
                        </tr>
                    `;
                }
            }
        }

        // Function to close a position (can be implemented later)
        function closePosition(symbol) {
            if (confirm(`Are you sure you want to close your ${symbol} position?`)) {
                // TODO: Implement actual position closing via API
                console.log(`Closing position for ${symbol}`);
                alert(`Position close request for ${symbol} submitted.`);
                // After successful close, refresh positions
                updateCurrentPositions();
            }
        }

        function updateWithDemoData() {
            // Fallback demo data when backend is unavailable - use fresh start values
            const portfolioValue = 0.00; // Fresh start - no trades yet
            const portfolioElement = document.getElementById('portfolioValue');
            if (portfolioElement) {
                portfolioElement.textContent = formatPrice(portfolioValue);
            }

            const todayPnl = 0.00; // Fresh start - no P&L yet
            const pnlElement = document.getElementById('todayPnl');
            if (pnlElement) {
                pnlElement.textContent = `${formatPrice(todayPnl)} (0.00%)`;
            }

            const confidence = 75 + (Math.random() - 0.5) * 10; // Realistic AI confidence
            const confidenceElement = document.getElementById('confidenceLevel');
            if (confidenceElement) {
                confidenceElement.textContent = confidence.toFixed(0) + '%';
            }

            // Update active positions - fresh start
            const positionsElement = document.getElementById('activePositions');
            if (positionsElement) {
                positionsElement.textContent = '0'; // No positions yet
            }

            // Update win rate - fresh start  
            const winRateElement = document.getElementById('winRate');
            if (winRateElement) {
                winRateElement.textContent = '0.0%'; // No trades yet
            }
        }

        function updateWithFreshStartData() {
            // Fresh start data for new trading account
            const portfolioElement = document.getElementById('portfolioValue');
            if (portfolioElement) {
                portfolioElement.textContent = formatPrice(0.00);
            }

            const pnlElement = document.getElementById('todayPnl');
            if (pnlElement) {
                pnlElement.textContent = `${formatPrice(0.00)} (0.00%)`;
            }

            const confidenceElement = document.getElementById('confidenceLevel');
            if (confidenceElement) {
                confidenceElement.textContent = '75%'; // Default AI confidence
            }

            const positionsElement = document.getElementById('activePositions');
            if (positionsElement) {
                positionsElement.textContent = '0';
            }

            const winRateElement = document.getElementById('winRate');
            if (winRateElement) {
                winRateElement.textContent = '0.0%';
            }
        }

        // News update functions
        async function updateAllNews() {
            console.log('üîÑ Starting news update cycle...');
            // Clear all news containers first
            const containers = ['positiveNews', 'negativeNews', 'generalNews'];
            containers.forEach(id => {
                const container = document.getElementById(id);
                if (container) {
                    container.innerHTML = '<div class="news-item loading">Fetching real news data...</div>';
                }
            });
            
            await Promise.all([
                updatePositiveNews(),
                updateNegativeNews(), 
                updateGeneralNews()
            ]);
            console.log('‚úÖ All news sections updated');
        }        async function updatePositiveNews() {
            try {
                console.log('üîç Fetching positive news from API...');
                const response = await fetch('http://localhost:8002/api/v1/news/positive');
                console.log('üì° News API Response Status:', response.status);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('‚úÖ News data received:', data.news.length, 'articles');
                    console.log('üì∞ Sample headline:', data.news[0]?.headline);
                    
                    const container = document.getElementById('positiveNews');
                    if (container) {
                        container.innerHTML = '';
                        
                        data.news.slice(0, 3).forEach(item => {
                            const newsElement = document.createElement('div');
                            newsElement.className = 'news-item news-sentiment-positive';
                            
                            const timeAgo = getTimeAgo(new Date(item.timestamp));
                            newsElement.innerHTML = `
                                <div class="news-headline" onclick="openNewsModal('${item.headline}', '${item.source}', '${timeAgo}', 'positive', '${item.headline}')">${item.headline}</div>
                                <div class="news-source">${item.source}</div>
                                <div class="news-time">${timeAgo}</div>
                            `;
                            container.appendChild(newsElement);
                        });
                        console.log('‚úÖ Positive news updated successfully');
                    }
                } else {
                    console.error('‚ùå News API failed:', response.status);
                }
            } catch (error) {
                console.error('‚ùå Error updating positive news:', error);
            }
        }        async function updateNegativeNews() {
            try {
                const response = await fetch('http://localhost:8002/api/v1/news/negative');
                if (response.ok) {
                    const data = await response.json();
                    const container = document.getElementById('negativeNews');
                    if (container) {
                        container.innerHTML = '';

                        data.news.slice(0, 3).forEach(item => {
                            const newsElement = document.createElement('div');
                            newsElement.className = 'news-item news-sentiment-negative';

                            const timeAgo = getTimeAgo(new Date(item.timestamp));
                            newsElement.innerHTML = `
                                <div class="news-headline" onclick="openNewsModal('${item.headline}', '${item.source}', '${timeAgo}', 'negative', '${item.headline}')">${item.headline}</div>
                                <div class="news-source">${item.source}</div>
                                <div class="news-time">${timeAgo}</div>
                            `;
                            container.appendChild(newsElement);
                        });
                    }
                }
            } catch (error) {
                console.log('Error updating negative news:', error);
            }
        }

        async function updateGeneralNews() {
            try {
                const response = await fetch('http://localhost:8002/api/v1/news/general');
                if (response.ok) {
                    const data = await response.json();
                    const container = document.getElementById('generalNews');
                    if (container) {
                        container.innerHTML = '';

                        data.news.slice(0, 3).forEach(item => {
                            const newsElement = document.createElement('div');
                            newsElement.className = 'news-item news-sentiment-neutral';

                            const timeAgo = getTimeAgo(new Date(item.timestamp));
                            newsElement.innerHTML = `
                                <div class="news-headline" onclick="openNewsModal('${item.headline}', '${item.source}', '${timeAgo}', 'neutral', '${item.headline}')">${item.headline}</div>
                                <div class="news-source">${item.source}</div>
                                <div class="news-time">${timeAgo}</div>
                            `;
                            container.appendChild(newsElement);
                        });
                    }
                }
            } catch (error) {
                console.log('Error updating general news:', error);
            }
        }

        function getTimeAgo(timestamp) {
            const now = new Date();
            const diff = now - timestamp;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(minutes / 60);

            if (hours > 0) {
                return `${hours}h ago`;
            } else if (minutes > 0) {
                return `${minutes}m ago`;
            } else {
                return 'Just now';
            }
        }

        // Modal functions
        function openNewsModal(title, source, time, sentiment, headline) {
            // Escape quotes in the parameters
            title = title.replace(/'/g, "&#39;");
            source = source.replace(/'/g, "&#39;");

            document.getElementById('modalTitle').innerHTML = title;
            document.getElementById('modalSource').innerHTML = source;
            document.getElementById('modalTime').innerHTML = time;

            const sentimentBadge = document.getElementById('modalSentiment');
            sentimentBadge.className = `modal-sentiment ${sentiment}`;
            sentimentBadge.innerHTML = sentiment.charAt(0).toUpperCase() + sentiment.slice(1);

            // Generate detailed content based on the headline
            const detailedContent = generateNewsContent(headline, sentiment);
            document.getElementById('modalContent').innerHTML = detailedContent;

            document.getElementById('newsModal').style.display = 'block';
        }

        function closeNewsModal() {
            document.getElementById('newsModal').style.display = 'none';
        }

        function generateNewsContent(headline, sentiment) {
            // Generate realistic news content dynamically based on the actual headline
            // This function is ONLY for modal popup content, not main news display
            
            // Dynamic content generation based on actual headline keywords
            if (headline.toLowerCase().includes('bitcoin') || headline.toLowerCase().includes('btc')) {
                return 'Bitcoin continues to show strong market performance with significant trading volume and institutional interest. The cryptocurrency has demonstrated resilience across various market conditions, with analysts monitoring key support and resistance levels. Market participants are closely watching regulatory developments and adoption trends that could influence future price movements.';
            }
            
            if (headline.toLowerCase().includes('ethereum') || headline.toLowerCase().includes('eth')) {
                return 'Ethereum maintains its position as a leading blockchain platform with continued development in decentralized finance and smart contract applications. The network has shown consistent growth in transaction volume and developer activity. Market observers are tracking upcoming protocol upgrades and their potential impact on network efficiency and scalability.';
            }
            
            if (headline.toLowerCase().includes('inflation')) {
                return 'Economic indicators continue to reflect changing inflation dynamics as policymakers balance growth objectives with price stability concerns. Market participants are analyzing data trends and central bank communications for guidance on future monetary policy directions. The current environment requires careful monitoring of economic indicators and their broader market implications.';
            }
            
            if (headline.toLowerCase().includes('earnings') || headline.toLowerCase().includes('profit')) {
                return 'Corporate earnings reports provide valuable insights into business performance and economic trends across various sectors. Companies are navigating current market conditions while focusing on operational efficiency and strategic growth initiatives. Investors are evaluating earnings quality and forward guidance to assess long-term investment prospects.';
            }

            // Default content generation
            const defaultContent = sentiment === 'positive' ?
                'This positive market development has been well-received by investors and analysts. The news reflects strong fundamentals and growing confidence in market conditions. Industry experts suggest this could lead to continued positive momentum in related sectors.' :
                sentiment === 'negative' ?
                    'This development has raised concerns among market participants about potential impacts on economic growth and stability. Analysts are monitoring the situation closely and may adjust their forecasts accordingly. Risk management strategies are being reviewed by institutional investors.' :
                    'This market update provides important context for current trading conditions. Investors are analyzing the implications for portfolio positioning and risk management. The development is part of ongoing market dynamics that require careful monitoring.';

            return defaultContent;
        }

        // Close modal when clicking outside of it
        window.onclick = function (event) {
            const modal = document.getElementById('newsModal');
            if (event.target == modal) {
                closeNewsModal();
            }
        }

        // Close modal with Escape key
        document.addEventListener('keydown', function (event) {
            if (event.key === 'Escape') {
                closeNewsModal();
            }
        });

        // Update dashboard every 10 seconds (reduced frequency to prevent flashing)
        let dashboardInterval;

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function () {
            updateDashboard();
            updateFooter(); // Initialize footer status
            loadMarketSymbols(); // Load default stock symbols
            updateAllMarketPrices(); // Load all market prices immediately
            updateAllNews(); // Load news immediately

            // MUCH gentler polling to prevent internet connection strain
            dashboardInterval = setInterval(updateDashboard, 60000); // Every 1 minute instead of 10 seconds

            // Update market prices every 2 minutes instead of 12 seconds
            setInterval(() => updateAllMarketPrices(), 120000);

            // Update news every 5 minutes instead of 30 seconds
            setInterval(() => updateAllNews(), 300000);

            // Update footer every 30 seconds
            setInterval(() => updateFooter(), 30000);

            // Update positions every 2 minutes
            setInterval(() => updateCurrentPositions(), 120000);
        });

        // Currency conversion functionality
        let currentCurrency = 'USD';
        let usdToEurRate = 0.85; // Approximate rate, should be fetched from API

        async function fetchExchangeRate() {
            try {
                // You can replace this with a real forex API
                const response = await fetch('http://localhost:8002/api/v1/market/prices/forex?limit=1');
                if (response.ok) {
                    const data = await response.json();
                    // Look for EUR/USD rate
                    if (data.prices && data.prices['EURUSD=X']) {
                        usdToEurRate = 1 / data.prices['EURUSD=X'].price; // Convert EUR/USD to USD/EUR
                    }
                }
            } catch (error) {
                console.log('Using default exchange rate');
            }
        }

        function changeCurrency() {
            const select = document.getElementById('currencySelect');
            currentCurrency = select.value;
            
            // Update all price displays
            updateAllPriceDisplays();
        }

        function formatPrice(usdPrice, showSymbol = true) {
            // Handle zero values properly
            if (usdPrice === 0 || usdPrice === '0' || usdPrice === '0.00') {
                return currentCurrency === 'EUR' ? '‚Ç¨0.00' : '$0.00';
            }
            
            const numPrice = parseFloat(usdPrice);
            if (isNaN(numPrice)) {
                return currentCurrency === 'EUR' ? '‚Ç¨0.00' : '$0.00';
            }
            
            if (currentCurrency === 'EUR') {
                const eurPrice = numPrice * usdToEurRate;
                return showSymbol ? `‚Ç¨${eurPrice.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}` : eurPrice;
            }
            return showSymbol ? `$${numPrice.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}` : numPrice;
        }

        async function updateAllPriceDisplays() {
            try {
                // For fresh start, show zero values instead of backend demo data
                // Update portfolio value - starting fresh
                const portfolioElement = document.getElementById('portfolioValue');
                if (portfolioElement) {
                    portfolioElement.textContent = formatPrice(0.00); // Fresh start - no trades yet
                }

                // Update P&L - starting fresh  
                const pnlElement = document.getElementById('todayPnl');
                if (pnlElement) {
                    pnlElement.textContent = `${formatPrice(0.00)} (0.00%)`;
                }

                // Update total return - starting fresh
                const returnElement = document.getElementById('totalReturn');
                if (returnElement) {
                    returnElement.textContent = `${formatPrice(0.00)} (0.0%)`;
                }

                // Update active positions - starting fresh
                const positionsElement = document.getElementById('activePositions');
                if (positionsElement) {
                    positionsElement.textContent = '0'; // No positions yet
                }
            } catch (error) {
                console.log('Error updating price displays:', error);
            }

            // Update all chart data and other price displays
            updateDashboard();
        }

        // Initialize exchange rate on load
        fetchExchangeRate();

        // Debug function - call this from console to force news refresh
        window.forceNewsRefresh = function() {
            console.log('üîÑ FORCE REFRESHING NEWS...');
            // Completely clear and reload news
            ['positiveNews', 'negativeNews', 'generalNews'].forEach(id => {
                const container = document.getElementById(id);
                if (container) {
                    container.innerHTML = '<div class="news-item loading">üöÄ Force refreshing...</div>';
                }
            });
            setTimeout(() => updateAllNews(), 500);
        };

        // Debug function - call this to check current news container content
        window.checkNewsContent = function() {
            ['positiveNews', 'negativeNews', 'generalNews'].forEach(id => {
                const container = document.getElementById(id);
                console.log(`${id}:`, container ? container.innerHTML.substring(0, 200) + '...' : 'NOT FOUND');
            });
        };

        // Add immediate news reload button
        window.reloadNewsNow = function() {
            console.log('üîÑ IMMEDIATE NEWS RELOAD');
            fetch('http://localhost:8002/api/v1/news/positive')
                .then(r => r.json())
                .then(data => {
                    console.log('Direct API test:', data.news[0].headline);
                    const container = document.getElementById('positiveNews');
                    console.log('Container before update:', container.innerHTML.substring(0, 100));
                    
                    // FORCE clear and replace content
                    container.innerHTML = '';
                    
                    // Create new element with real data
                    const newsElement = document.createElement('div');
                    newsElement.className = 'news-item news-sentiment-positive';
                    newsElement.innerHTML = `
                        <div class="news-headline" onclick="openNewsModal('${data.news[0].headline}', '${data.news[0].source}', 'Just now', 'positive', '${data.news[0].headline}')">${data.news[0].headline}</div>
                        <div class="news-source">${data.news[0].source}</div>
                        <div class="news-time">Just now</div>
                    `;
                    container.appendChild(newsElement);
                    
                    console.log('Container after update:', container.innerHTML.substring(0, 100));
                    console.log('‚úÖ Direct update complete - check if display changed');
                })
                .catch(err => console.error('Direct API test failed:', err));
        };

        // Add function to completely clear all news and force refresh
        window.nukeAndReloadNews = function() {
            console.log('üí• NUCLEAR NEWS RELOAD - CLEARING EVERYTHING');
            
            // STOP all intervals to prevent interference
            if (window.newsInterval) clearInterval(window.newsInterval);
            if (window.dashboardInterval) clearInterval(window.dashboardInterval);
            console.log('üõë Stopped all auto-update intervals');
            
            // Clear all containers aggressively
            ['positiveNews', 'negativeNews', 'generalNews'].forEach(id => {
                const container = document.getElementById(id);
                if (container) {
                    container.innerHTML = '<div class="news-item loading">ÔøΩ NUCLEAR REFRESH IN PROGRESS...</div>';
                    console.log(`Cleared ${id} container`);
                }
            });
            
            // Wait a moment then force reload with REAL data only
            setTimeout(() => {
                console.log('üî• FORCING REAL NEWS API CALLS ONLY...');
                
                // Force fetch REAL news and bypass all other updates
                fetch('http://localhost:8002/api/v1/news/positive')
                    .then(r => r.json())
                    .then(data => {
                        console.log('üöÄ REAL POSITIVE NEWS:', data.news[0].headline);
                        const container = document.getElementById('positiveNews');
                        container.innerHTML = '';
                        
                        data.news.slice(0, 3).forEach(item => {
                            const newsElement = document.createElement('div');
                            newsElement.className = 'news-item news-sentiment-positive';
                            newsElement.innerHTML = `
                                <div class="news-headline">${item.headline}</div>
                                <div class="news-source">${item.source}</div>
                                <div class="news-time">REAL DATA - Just now</div>
                            `;
                            container.appendChild(newsElement);
                        });
                        console.log('‚úÖ POSITIVE NEWS FORCED WITH REAL DATA');
                    });
                    
                // Do the same for other news sections
                setTimeout(() => {
                    fetch('http://localhost:8002/api/v1/news/negative')
                        .then(r => r.json())
                        .then(data => {
                            const container = document.getElementById('negativeNews');
                            container.innerHTML = '';
                            data.news.slice(0, 3).forEach(item => {
                                const newsElement = document.createElement('div');
                                newsElement.className = 'news-item news-sentiment-negative';
                                newsElement.innerHTML = `
                                    <div class="news-headline">${item.headline}</div>
                                    <div class="news-source">${item.source}</div>
                                    <div class="news-time">REAL DATA - Just now</div>
                                `;
                                container.appendChild(newsElement);
                            });
                            console.log('‚úÖ NEGATIVE NEWS FORCED WITH REAL DATA');
                        });
                }, 500);
                
            }, 1000);
        };
    </script>

    <!-- Footer Section -->
    <footer class="dashboard-footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>AI Trading Platform</h3>
                <p>Advanced algorithmic trading with real-time market data and AI-powered insights.</p>
                <div class="footer-stats">
                    <div class="footer-stat">
                        <span class="stat-label">Total Trades:</span>
                        <span class="stat-value" id="footer-total-trades">0</span>
                    </div>
                    <div class="footer-stat">
                        <span class="stat-label">Success Rate:</span>
                        <span class="stat-value" id="footer-success-rate">0%</span>
                    </div>
                </div>
            </div>

            <div class="footer-section">
                <h3>Market Coverage</h3>
                <div class="footer-markets">
                    <div class="footer-market">üìà Stocks</div>
                    <div class="footer-market">‚Çø Cryptocurrency</div>
                    <div class="footer-market">üí± Forex</div>
                    <div class="footer-market">üèÜ Commodities</div>
                    <div class="footer-market">üìä Indices</div>
                </div>
            </div>

            <div class="footer-section">
                <h3>System Status</h3>
                <div class="footer-status">
                    <div class="status-item">
                        <span class="status-dot" id="backend-status"></span>
                        <span>Backend: <span id="backend-status-text">Checking...</span></span>
                    </div>
                    <div class="status-item">
                        <span class="status-dot" id="data-status"></span>
                        <span>Data Feed: <span id="data-status-text">Checking...</span></span>
                    </div>
                    <div class="status-item">
                        <span class="status-dot" id="ai-status"></span>
                        <span>AI Engine: <span id="ai-status-text">Checking...</span></span>
                    </div>
                </div>
            </div>

            <div class="footer-section">
                <h3>Performance</h3>
                <div class="footer-performance">
                    <div class="perf-metric">
                        <span class="perf-label">Uptime:</span>
                        <span class="perf-value" id="footer-uptime">99.9%</span>
                    </div>
                    <div class="perf-metric">
                        <span class="perf-label">Latency:</span>
                        <span class="perf-value" id="footer-latency">
                            < 50ms</span>
                    </div>
                    <div class="perf-metric">
                        <span class="perf-label">Last Update:</span>
                        <span class="perf-value" id="footer-last-update">--:--</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer-bottom">
            <div class="footer-copyright">
                ¬© 2025 JCW Trade Hub - AI Trading Platform - JCW Web Technologies
            </div>
            <div class="footer-version">
                Version 2.0.1 | Build: 20251018
            </div>
        </div>
    </footer>
</body>

</html>